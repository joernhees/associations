<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description"
        content="GraphPatternLearner Association Prediction Demo">
  <meta name="author" content="Jörn Hees">

  <title>GraphPatternLearner Association Prediction Demo</title>

  <base href="../../" target="_blank">

  <!-- Bootstrap Core CSS -->
  <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">

  <!-- Custom Fonts -->
  <link
    href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
    rel='stylesheet' type='text/css'>
  <link
    href='//fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic'
    rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css"
        type="text/css">

  <!-- Plugin CSS -->
  <link rel="stylesheet" href="css/animate.min.css" type="text/css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/creative.css" type="text/css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <style>
    /* reset button group to bootstrap as it's overwritten by creative */
    .input-group .input-group-btn .btn {
      border: 1px solid transparent;
      border-radius: 4px;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    .input-group .input-group-btn .btn-default {
      color: #333;
      background-color: #fff;
      border-color: #ccc;
    }

    #header-wrapper {
      min-height: 1100px;
    }
    header .header-content .header-content-inner p {
      margin-top: 15px;
      margin-bottom: 15px;
    }

    #predictionResults .panel-body {
      min-height: 600px;
    }

    #demo .placeholder {
      height: 50vh;
      display: flex;
      align-items: center;
    }

    /* always show selected buttons (o*/
    #demo table>tbody>tr>td>div.feedback>button,
    #demo table>tbody>tr:hover>td>div.feedback.selected>button {
      opacity: 0.2;
    }
    #demo table>tbody>tr:hover>td>div.feedback>button,
    #demo table>tbody>tr>td>div.feedback.selected>button.selected,
    #demo table>tbody>tr:hover>td>div.feedback.selected>button.selected {
      opacity: 1.0;
    }
  </style>
</head>

<body id="page-top">

<nav id="mainNav" class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://w3id.org/associations/#gp_learner">Associations</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a class="page-scroll" href="#demo">Prediction Demo</a>
        </li>
        <li>
          <a class="page-scroll" href="#moreInfo">Further Information</a>
        </li>
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container-fluid -->
</nav>

<header class="bg-dark">
  <div id="header-wrapper">
    <div class="header-content">
      <div class="header-content-inner">
        <h1>Human Association Prediction Demo</h1>
        <hr>
        <p>
          This page demonstrates how <a href="https://en.wikipedia.org/wiki/Association_(psychology)">human associations</a> can be simulated with <a href="https://en.wikipedia.org/wiki/Linked_data">Linked Data</a>.
        </p>
        <p>
          For this demo, we used the <a href="https://w3id.org/associations/#gp_learner">Graph Pattern Learner</a> to train a machine learning model on a training <a href="https://w3id.org/associations/#datasets">dataset of human associations</a> (e.g., <a href="http://dbpedia.org/resource/Dog">Dog</a> - <a href="http://dbpedia.org/resource/Cat">Cat</a>).
        </p>
        <p>
          Click <a href="#demo" class="page-scroll">continue</a> to try the <i>trained model</i> out yourself by entering a <i>source</i> node and have it predict <i>target</i> nodes that humans are likely to associate.
        </p>
        <p><img style="width: 80%; min-width: 600px" src="gp_learner/demo/ml_outline_crop.png"></p>
        <a href="#demo" class="btn btn-primary btn-xl page-scroll">Continue</a>
      </div>
    </div>
  </div>
</header>

<section id="demo">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 text-center">
        <h2 class="section-heading">Demo</h2>
        <hr class="primary">
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-xs12">
        <div class="row">
          <div class="col-sm-offset-1 col-sm-10">
            <form id="stimulusForm" class="form">
              <div class="form-group">
                <label>Enter a stimulus:</label>
                <div class="input-group">
                  <input class="form-control autocomplete"
                         type="text"
                         autocomplete="off"
                         placeholder="e.g., Dog, Cat, House, Horse"/>
                  <span class="input-group-btn">
                    <button type="submit" class="btn btn-default" data-loading-text="<i class='fa fa-spinner fa-spin fa-large'></i> predicting...">Submit</button>
                  </span>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-offset-1 col-sm-10">
            <div id="predictionResults" class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">Prediction Results</h3>
              </div>
              <div class="panel-body">
                <div class="placeholder jumbotron text-center">
                  <div class="col-xs-12 col-sm-offset-2 col-sm-8">
                    Results will be shown here
                  </div>
                </div>
                <table class="hidden table table-hover">
                  <thead><tr>
                    <th>#</th>
                    <th>Predicted response</th>
                    <th>Score</th>
                    <th>Explain</th>
                    <th>Feedback</th>
                  </tr></thead>
                  <tbody>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="moreInfo" class="bg-dark">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 text-center">
        <h2 class="section-heading">Want to find out more?</h2>
        <hr class="primary">
        <p>For more information make sure to visit the <a href="https://w3id.org/associations">main page</a>.</p>
        <p>Have a question, some idea, feedback or want to collaborate?</p>
        <p>Feel free to reach out:</p>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 text-center">
        <i class="fa fa-envelope-o fa-3x wow bounceIn"></i>
        <p><img src="./img/m.png"></p>
      </div>
      <div class="col-md-4 text-center">
        <i class="fa fa-user fa-3x wow bounceIn" data-wow-delay=".1s"></i>
        <p><a href="https://joernhees.de/blog/about" target="_blank">Jörn Hees</a><br>(main contact)</p>
      </div>
      <div class="col-md-4 text-center">
        <i class="fa fa-users fa-3x wow bounceIn" data-wow-delay=".2s"></i>
        <p><a href="https://km.dfki.de/" target="_blank">DFKI Knowledge Management</a><br>(our research group)</p>
      </div>
    </div>
  </div>
</section>


<!-- jQuery -->
<script src="js/jquery.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="js/jquery.easing.min.js"></script>
<script src="js/jquery.fittext.js"></script>
<script src="js/wow.min.js"></script>
<script src="js/bootstrap3-typeahead.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="js/creative.js"></script>


<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"
        charset="utf-8"></script>
<script>
    if (!window.d3) {
        console.warn("d3js.org not reachable");
        document.write('<script src="js/d3.min.js">\x3C/script>');
    }
</script>

<script src="gp_learner/demo/predict_config.js"></script>
<script>
    let demo_source = '';
    const $demo = $('#demo');
    const $predictionResults = $demo.find('#predictionResults');
    const $stimulusForm = $('#stimulusForm');

    function reset() {
        // resets the GUI
        demo_source = '';

        // show placeholder, hide table
        $predictionResults.find('.placeholder').removeClass('hidden');
        $predictionResults.find('table').addClass('hidden');
    }

    function predict(source) {
        if (!source.startsWith('http://dbpedia.org/resource/')) {
            return;
        }
        let $input = $stimulusForm.find('input');
        $input.prop('disabled', true).val(source).text(source).blur();
        let $btn = $stimulusForm.find('button').button('loading');

        demo_source = source;
        $.post(
            gpl_endpoint_predict,
            {source: source},
            function (data) {
                console.log(data);
                const $table = $predictionResults.find('table');
                const $tbody = $table.find('tbody');
                for (let fm of ['target_occs',]) {
                    $tbody.html('');
                    let res = data['fused_results'][fm];
                    console.log(res);
                    for (let i=0; i < Math.min(res.length, MAX_RESULT_ROWS); i++) {
                        let [target, score] = res[i];
                        console.log(target, score);
                        let starget = target.replace(/http:\/\/dbpedia.org\/resource\//, 'dbr:');
                        if (starget.length > 30) {
                            starget = starget.slice(0, 30) + '...';
                        }
                        $tbody.append(
                            '<tr>' +
                                '<td class="rank">' + (i+1) + '</td>' +
                                '<td><a class="target" href="' + target + '">' + starget + '</a></td>' +
                                '<td>' + score + '</td>' +
                                '<td>--</td>' +
                                '<td>' +
                                    '<div class="feedback btn-group" role="group">' +
                                        '<button class="btn btn-xs btn-success feedback-positive"><i class="fa fa-check" aria-hidden="true"></i></button>' +
                                        '<button class="btn btn-xs btn-warning feedback-negative"><i class="fa fa-times" aria-hidden="true"></i></button>' +
                                    '</div>' +
                                '</td>' +
                            '</tr>'
                        );
                    }
                    if (res.length > MAX_RESULT_ROWS) {
                        $tbody.append(
                            '<tr><td class="text-center" colspan="5">... ' + (res.length - MAX_RESULT_ROWS) + ' further results hidden to save your browser.</td></tr>'
                        );
                    }
                }
                $table.find('.feedback .btn').click(feedback);
                $table.removeClass('hidden');
                $predictionResults.find('.placeholder').addClass('hidden');
            },
            'json'
        ).fail(function(jqXHR, textStatus, errorThrown) {
        }).always(function () {
            $input.prop('disabled', false);
            $btn.button('reset');
        });
    }

    function feedback(event) {
        let $btn = $(this);
        $btn.parent().addClass('selected').children().removeClass('selected');
        $btn.addClass('selected');
        let $row = $btn.parents('tr');
        let target = $row.find('td a.target').attr('href');
        let feedback = $btn.hasClass('feedback-positive');
        let rank = parseInt($row.find('td.rank').text());
        let fm = 'target_occs';
        let fb = {
            'source': demo_source,
            'target': target,
            'feedback': feedback,
            'fusion_method': fm,
            'rank': rank
        };
        // console.log(fb);
        $.post(gpl_endpoint_feedback, fb, null, 'json');
    }

    let $stimulusAutocomplete = $stimulusForm.find('.autocomplete').typeahead({
        'source': function (query, process) {
            reset();
            return $.get(
                '//en.wikipedia.org/w/api.php',
                {
                    'action': 'opensearch',
                    'format': 'json',
                    'redirects': 'resolve',
                    'origin': '*',
                    'search': query
                },
                function (data) {
                    let titles = data[1];
                    let descriptions = data[2];
                    let uris = data[3];
                    let items = [];
                    for (let i=0; i<titles.length; i++) {
                        items.push({
                            'title': titles[i],
                            'desc': descriptions[i],
                            'uri': uris[i]
                        });
                    }
                    return process(items);
                },
                'json'
            );
        },
        'items': 10,
        'matcher': function(x) {return true},
        'sorter': function(x) {return x},
        'displayText': function(item) {
            return `${item.title} <a href="${item.uri}">${item.uri}</a>`
        },
        'afterSelect': function(item) {
            let uri = item.uri;
            uri = uri.replace(/^https?:\/\/\w+\.wikipedia\.org\/wiki\//, 'http://dbpedia.org/resource/');
            this.$element.val(uri);
            this.$element.text(uri);
            $('#stimulusForm').find('button').click();
            // predict(uri);
            return uri;
        },
        'autoSelect': true
    });
    $stimulusAutocomplete.focus(function () {
        $(this).val('');
    });
    $stimulusForm.submit(function (event) {
        let source = $(this).find('.autocomplete').val();
        predict(source);
        event.preventDefault();
        return false;
    });
</script>

<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-81338887-1', 'auto');
    ga('send', 'pageview');
</script>

</body>

</html>
